@model IEnumerable<AgriShop_Consume.Models.SupplierModel>
@{
    ViewData["Title"] = "Supplier List";
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Modern CSS Variables to match _Layout.cshtml */
        :root {
            --primary-color: #22c55e;
            --secondary-color: #f8f9fa;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --border-radius: 0.5rem;
        }

        /* Table Container */
        .table-container {
            max-width: 1200px;
            margin: 2rem auto;
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }

        /* Search Container */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .search-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
            }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Table Styles */
        .table-wrapper {
            overflow-x: auto;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

            .table th {
                padding: 1rem;
                background: var(--secondary-color);
                color: var(--text-primary);
                font-weight: 600;
                border-bottom: 2px solid var(--border-color);
                white-space: nowrap;
            }

            .table td {
                padding: 1rem;
                border-bottom: 1px solid var(--border-color);
                vertical-align: middle;
            }

            .table tbody tr:nth-child(even) {
                background: rgba(248, 250, 252, 0.5);
            }

            .table tbody tr:hover {
                background: rgba(34, 197, 94, 0.05);
                transform: translateX(2px);
                transition: all 0.2s ease;
            }

            .table tbody tr.hidden {
                display: none;
            }

        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }

            .pagination-container button {
                margin: 0 0.25rem;
                padding: 0.5rem 1rem;
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                background: white;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.2s ease;
            }

                .pagination-container button:hover {
                    background: var(--primary-color);
                    color: white;
                    border-color: var(--primary-color);
                }

                .pagination-container button.active {
                    background: var(--primary-color);
                    color: white;
                    border-color: var(--primary-color);
                }

                .pagination-container button:disabled {
                    background: var(--secondary-color);
                    color: var(--text-secondary);
                    cursor: not-allowed;
                }

        /* Status Messages */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            display: none;
        }

            .no-results i {
                font-size: 3rem;
                margin-bottom: 1rem;
                opacity: 0.5;
            }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            display: none;
        }

        /* Responsive Design */
        @@media (max-width: 768px) {
            .table-container

        {
            padding: 1rem;
        }

        .table th, .table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.875rem;
        }

        .table thead {
            display: none;
        }

        .table tbody tr {
            display: block;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }

        .table tbody td {
            display: block;
            text-align: right;
            position: relative;
            padding-left: 50%;
        }

            .table tbody td:before {
                content: attr(data-label);
                position: absolute;
                left: 0.5rem;
                font-weight: bold;
                text-align: left;
            }

        .action-buttons {
            text-align: center;
            padding: 0.5rem;
        }

        }

        @@media (max-width: 600px) {
            .table-wrapper

        {
            overflow-x: scroll;
        }

        .table {
            min-width: 600px;
        }

        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        .search-input:focus, .btn:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Animation */
        .table tbody tr {
            animation: fadeIn 0.3s ease;
        }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }</style>

    <script>
        $(document).ready(function () {
            let currentPage = 1;
            const itemsPerPage = 10;
            let allSuppliers = [];
            let searchTimeout;

            // Store initial data from server-side rendering
            const initialSuppliers = [];
            $('#supplierTableBody tr').each(function () {
                const $row = $(this);
                initialSuppliers.push({
                    SupplierId: $row.find('td:eq(0)').text(),
                    SupplierName: $row.find('td:eq(1)').text(),
                    Contact: $row.find('td:eq(2)').text(),
                    Address: $row.find('td:eq(3)').text()
                });
            });
            allSuppliers = initialSuppliers;

            // Fetch suppliers from API
            function fetchSuppliers(searchTerm = '', page = 1) {
                $('#loading').show();
                $('#noResults').hide();
                $.ajax({
                    url: '@Url.Action("GetSuppliers", "Supplier")',
                    method: 'GET',
                    data: { search: searchTerm, page: page, pageSize: itemsPerPage },
                    success: function (response) {
                        allSuppliers = response.suppliers || [];
                        renderTable(allSuppliers);
                        renderPagination(response.totalCount || initialSuppliers.length);
                        $('#loading').hide();
                        if (allSuppliers.length === 0) {
                            $('#noResults').show();
                        }
                        announceResults(allSuppliers.length, searchTerm);
                    },
                    error: function () {
                        $('#loading').hide();
                        $('#noResults').text('Error loading data. Please try again.').show();
                    }
                });
            }

            // Render table rows
            function renderTable(suppliers) {
                const $tableBody = $('#supplierTableBody');
                $tableBody.empty();
                suppliers.forEach(supplier => {
                    $tableBody.append(`
                        <tr role="row" data-supplier-id="${supplier.SupplierId}" data-searchable="${(supplier.SupplierName + ' ' + supplier.Contact + ' ' + supplier.Address).toLowerCase()}">
                            <td data-label="Supplier ID">${supplier.SupplierId}</td>
                            <td data-label="Supplier Name"><strong class="supplier-name">${supplier.SupplierName}</strong></td>
                            <td data-label="Contact" class="supplier-contact">${supplier.Contact}</td>
                            <td data-label="Address" class="supplier-address">${supplier.Address}</td>
                            <td data-label="Actions" class="action-buttons">
                                <a class="btn btn-sm btn-warning" asp-action="AddEdit" asp-controller="Supplier" asp-route-id="${supplier.SupplierId}" aria-label="Edit supplier ${supplier.SupplierName}">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                <a class="btn btn-sm btn-danger" asp-action="Delete" asp-controller="Supplier" asp-route-id="${supplier.SupplierId}" onclick="return confirm('Are you sure you want to delete ${supplier.SupplierName.replace(/'/g, "\\'")}?');" aria-label="Delete supplier ${supplier.SupplierName}">
                                    <i class="bi bi-trash"></i> Delete
                                </a>
                            </td>
                        </tr>
                    `);
                });
            }

            // Render pagination controls
            function renderPagination(totalCount) {
                const totalPages = Math.ceil(totalCount / itemsPerPage);
                const $pagination = $('#pagination');
                $pagination.empty();
                if (totalPages <= 1) return;

                $pagination.append(`
                    <button class="btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">Previous</button>
                `);
                for (let i = 1; i <= totalPages; i++) {
                    $pagination.append(`
                        <button class="btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>
                    `);
                }
                $pagination.append(`
                    <button class="btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">Next</button>
                `);
            }

            // Change page
            window.changePage = function (page) {
                currentPage = page;
                fetchSuppliers($('#searchInput').val(), currentPage);
            };

            // Client-side search filter
            function filterSuppliers(searchTerm) {
                const searchQuery = searchTerm.toLowerCase();
                let visibleCount = 0;

                if (!searchQuery) {
                    $('#supplierTableBody tr').each(function () {
                        $(this).removeClass('hidden').show();
                        clearHighlights($(this));
                        visibleCount++;
                    });
                    $('#supplierTable').show();
                    $('#noResults').hide();
                } else {
                    $('#supplierTableBody tr').each(function () {
                        const $row = $(this);
                        const searchableText = $row.data('searchable') || '';
                        if (searchableText.includes(searchQuery)) {
                            $row.removeClass('hidden').show();
                            highlightSearchTerms($row, searchTerm);
                            visibleCount++;
                        } else {
                            $row.addClass('hidden').hide();
                            clearHighlights($row);
                        }
                    });
                    if (visibleCount === 0) {
                        $('#supplierTable').hide();
                        $('#noResults').show();
                    } else {
                        $('#supplierTable').show();
                        $('#noResults').hide();
                    }
                }
                updateResultsInfo(visibleCount);
            }

            // Highlight search terms
            function highlightSearchTerms($row, query) {
                if (!query.trim()) return;
                const searchTerms = query.trim().toLowerCase().split(/\s+/);
                clearHighlights($row);
                const $cells = $row.find('.supplier-name, .supplier-contact, .supplier-address');
                $cells.each(function () {
                    const $cell = $(this);
                    let html = $cell.html();
                    searchTerms.forEach(term => {
                        if (term.length > 1) {
                            const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                            html = html.replace(regex, '<span class="highlight">$1</span>');
                        }
                    });
                    $cell.html(html);
                });
            }

            // Clear highlights
            function clearHighlights($row) {
                $row.find('.highlight').each(function () {
                    const $highlight = $(this);
                    $highlight.replaceWith($highlight.text());
                });
            }

            // Update results info
            function updateResultsInfo(visibleCount = null) {
                const visible = visibleCount !== null ? visibleCount : initialSuppliers.length;
                $('#visibleCount').text(visible);
                $('#totalCount').text(initialSuppliers.length);
            }

            // Accessibility announcement
            function announceResults(count, query) {
                let announcement = `${count} supplier${count !== 1 ? 's' : ''} found`;
                if (query) announcement += ` for search: ${query}`;
                $('#searchAnnouncement').remove();
                $('body').append(`<div id="searchAnnouncement" class="sr-only" aria-live="polite">${announcement}</div>`);
            }

            // Debounced search input
            $('#searchInput').on('input', function () {
                clearTimeout(searchTimeout);
                const searchTerm = $(this).val().trim();
                filterSuppliers(searchTerm); // Client-side filter
                searchTimeout = setTimeout(() => {
                    currentPage = 1; // Reset to first page
                    fetchSuppliers(searchTerm, currentPage); // Server-side search
                }, 300);
            });

            // Clear search on ESC key
            $('#searchInput').on('keydown', function (e) {
                if (e.keyCode === 27) { // ESC key
                    $(this).val('');
                    filterSuppliers('');
                }
            });

            // Initial setup
            updateResultsInfo();
            renderPagination(initialSuppliers.length);
        });
    </script>
}
<div class="main" id="main">
<div class="table-container">
    <div class="header-content">
        <h1><i class="bi bi-truck"></i> Supplier Management</h1>
        <div class="header-actions">
            <div class="search-container">
                <i class="bi bi-search search-icon" aria-hidden="true"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="Search suppliers by name, contact, or address..." aria-label="Search suppliers">
            </div>
            <a asp-action="AddEdit" asp-controller="Supplier" class="btn btn-primary-custom">
                <i class="bi bi-plus"></i> Add Supplier
            </a>
        </div>
    </div>

    <div class="results-info" id="resultsInfo">
        Showing <span id="visibleCount">@Model.Count()</span> of <span id="totalCount">@Model.Count()</span> suppliers
    </div>
    <div class="table-wrapper">
        <table class="table" id="supplierTable" role="table" aria-label="Supplier data table">
            <thead>
                <tr>
                    <th scope="col">Supplier ID <span class="sr-only">Column header</span></th>
                    <th scope="col">Supplier Name <span class="sr-only">Column header</span></th>
                    <th scope="col">Contact <span class="sr-only">Column header</span></th>
                    <th scope="col">Address <span class="sr-only">Column header</span></th>
                    <th scope="col">Actions <span class="sr-only">Available actions for each supplier</span></th>
                </tr>
            </thead>
            <tbody id="supplierTableBody">
                @foreach (var supplier in Model)
                {
                    <tr role="row" data-supplier-id="@supplier.SupplierId" data-searchable="@($"{supplier.SupplierName} {supplier.Contact} {supplier.Address}".ToLower())">
                        <td data-label="Supplier ID">@supplier.SupplierId</td>
                        <td data-label="Supplier Name"><strong class="supplier-name">@supplier.SupplierName</strong></td>
                        <td data-label="Contact" class="supplier-contact">@supplier.Contact</td>
                        <td data-label="Address" class="supplier-address">@supplier.Address</td>
                        <td data-label="Actions" class="action-buttons">
                            <a class="btn btn-sm btn-warning" asp-action="AddEdit" asp-controller="Supplier" asp-route-id="@supplier.SupplierId" aria-label="Edit supplier @supplier.SupplierName">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <a class="btn btn-sm btn-danger" asp-action="Delete" asp-controller="Supplier" asp-route-id="@supplier.SupplierId" onclick="return confirm('Are you sure you want to delete @Html.Raw(supplier.SupplierName.Replace("'", "\\'"))?');" aria-label="Delete supplier @supplier.SupplierName">
                                <i class="bi bi-trash"></i> Delete
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="pagination-container" id="pagination"></div>
</div>
</div>