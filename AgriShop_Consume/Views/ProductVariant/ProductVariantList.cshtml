@model IEnumerable<AgriShop_Consume.Models.ProductVariantModel>

@{
    ViewData["Title"] = "Product Variant Management";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    :root {
        --primary-color: #22c55e;
        --secondary-color: #f8f9fa;
        --accent-color: #16a34a;
    }

    .bg-primary-custom {
        background-color: var(--primary-color) !important;
    }

    .text-primary-custom {
        color: var(--primary-color) !important;
    }

    .btn-primary-custom {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }

        .btn-primary-custom:hover {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.3);
        }

    .variant-card {
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-radius: 12px;
        overflow: hidden;
    }

        .variant-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

    .admin-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 1rem 1rem;
    }

    .search-container {
        position: relative;
        max-width: 300px;
    }

    .search-input {
        border-radius: 25px;
        padding-left: 45px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(34, 197, 94, 0.25);
        }

    .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        z-index: 10;
    }

    .table-responsive {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .table th {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        color: white;
        border: none;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }

    .table td {
        vertical-align: middle;
        border-color: #e9ecef;
    }

    .table tbody tr:hover {
        background-color: rgba(34, 197, 94, 0.05);
        transform: scale(1.01);
        transition: all 0.2s ease;
    }

    .price-badge {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
    }

    .size-badge {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
        font-weight: 600;
        padding: 0.4rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
    }

    .no-data-container {
        text-align: center;
        padding: 4rem 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        margin: 2rem 0;
    }

    .no-data-icon {
        font-size: 4rem;
        color: #6c757d;
        margin-bottom: 1rem;
    }

    .action-buttons .btn {
        margin-right: 0.25rem;
        margin-bottom: 0.25rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .action-buttons .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

    .view-toggle-btn {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        border: none;
        color: white;
        border-radius: 25px;
        padding: 0.75rem 2rem;
        transition: all 0.3s ease;
    }

        .view-toggle-btn:hover {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

    .card-header-custom {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        color: white;
        border: none;
        border-radius: 12px 12px 0 0;
    }

    @@media (max-width: 767.98px) {
        .admin-header .h3 {
            font-size: 1.5rem;
        }

        .admin-header .badge {
            font-size: 0.9rem;
        }

        .action-buttons {
            flex-direction: column !important;
        }

            .action-buttons .btn {
                width: 100%;
                margin-right: 0;
            }

        .d-flex.justify-content-between.align-items-center.mb-4 {
            flex-direction: column;
            align-items: stretch !important;
            gap: 1rem;
        }

        .search-container {
            max-width: 100%;
        }

        .view-toggle-btn {
            width: 100%;
        }

        .table-responsive {
            font-size: 0.9rem;
        }

        .table th, .table td {
            padding: 0.5rem;
        }
    }
</style>

<body class="bg-light">
    <main class="main">
        <div class="container-fluid px-0">
            <!-- Admin Header -->
            <div class="admin-header">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="d-flex align-items-center gap-3 flex-wrap">
                                <div class="h3 mb-0 fw-bold">ðŸŒ¾ AgriMart</div>
                                <span class="badge bg-light text-dark">Product Variants</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container">
                <!-- Alert Messages -->
                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="bi bi-check-circle me-2"></i>@TempData["Success"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>@TempData["Error"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <!-- Page Header & Controls -->
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                    <div>
                        <h2 class="text-primary-custom fw-bold mb-1">Product Variant Management</h2>
                        <p class="text-muted mb-0">Manage product variants, sizes, and pricing</p>
                    </div>
                    <div class="d-flex gap-3 align-items-center flex-wrap">
                        <a class="btn btn-primary-custom btn-lg px-4" href="@Url.Action("AddEdit", "ProductVariant")">
                            <i class="bi bi-plus-circle me-2"></i>Add Variant
                        </a>
                    </div>
                </div>

                <!-- Filter Form -->
                <div class="card mb-4">
                    <div class="card-header card-header-custom">
                        <h5 class="mb-0"><i class="bi bi-funnel me-2"></i>Filter Product Variants</h5>
                    </div>
                    <div class="card-body">
                        <form method="get" asp-action="ProductVariantList" class="row g-3">
                            <div class="col-md-4">
                                <label for="productId" class="form-label">Product</label>
                                <select class="form-select" name="productId" id="productId">
                                    <option value="">All Products</option>
                                    @if (ViewBag.ProductList != null)
                                    {
                                        @foreach (var product in ViewBag.ProductList)
                                        {
                                            <option value="@product.Value" selected="@(ViewBag.ProductId?.ToString() == product.Value)">@product.Text</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="size" class="form-label">Size</label>
                                <input type="text" 
                                       class="form-control" 
                                       name="size" 
                                       id="size"
                                       value="@ViewBag.Size" 
                                       placeholder="Enter size (e.g., Small, Medium, Large)">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn-primary-custom">
                                        <i class="bi bi-search me-2"></i>Filter
                                    </button>
                                    @if (ViewBag.ProductId != null || !string.IsNullOrEmpty(ViewBag.Size))
                                    {
                                        <a asp-action="ProductVariantList" class="btn btn-outline-secondary">
                                            <i class="bi bi-x-circle me-2"></i>Clear
                                        </a>
                                    }
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Results Info -->
                @if (ViewBag.ProductId != null || !string.IsNullOrEmpty(ViewBag.Size))
                {
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> 
                        Showing filtered results
                        @if (ViewBag.ProductId != null)
                        {
                            <span class="ms-2">for Product ID: <strong>@ViewBag.ProductId</strong></span>
                        }
                        @if (!string.IsNullOrEmpty(ViewBag.Size))
                        {
                            <span class="ms-2">with Size: <strong>"@ViewBag.Size"</strong></span>
                        }
                        @if (Model.Any())
                        {
                            <span class="ms-2">(@Model.Count() result(s) found)</span>
                        }
                    </div>
                }

                <!-- No Data Message -->
                @if (Model == null || !Model.Any())
                {
                    <div class="no-data-container">
                        <i class="bi bi-inbox no-data-icon"></i>
                        @if (ViewBag.ProductId != null || !string.IsNullOrEmpty(ViewBag.Size))
                        {
                            <h4 class="text-muted mb-2">No Variants Match Your Filter</h4>
                            <p class="text-muted mb-3">No product variants match your current filter criteria. Try adjusting your search parameters.</p>
                            <a asp-action="ProductVariantList" class="btn btn-primary-custom">
                                <i class="bi bi-arrow-left me-2"></i>View All Variants
                            </a>
                        }
                        else
                        {
                            <h4 class="text-muted mb-2">No Product Variants Found</h4>
                            <p class="text-muted mb-3">Start by adding your first product variant to manage different sizes and pricing options.</p>
                            <a class="btn btn-primary-custom" href="@Url.Action("AddEdit", "ProductVariant")">
                                <i class="bi bi-plus-circle me-2"></i>Add First Variant
                            </a>
                        }
                    </div>
                }
                else
                {
                    <!-- Product Variant Grid View -->
                    <div class="row g-3" id="cardView">
                        @if (Model != null)
                        {
                            @foreach (var item in Model)
                            {
                                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4 d-flex variant-item"
                                     data-productid="@item.ProductId"
                                     data-size="@item.Size?.ToLower()"
                                     data-userid="@item.UserId">
                                    <div class="card variant-card h-100 w-100">
                                        <div class="card-header bg-white border-bottom-0 pb-0">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="card-title text-primary-custom fw-semibold mb-1">
                                                        <i class="bi bi-tags me-2"></i>Variant #@item.VariantId
                                                    </h6>
                                                    <span class="badge bg-secondary">Product ID: @item.ProductId</span>
                                                </div>
                                                <div class="dropdown">
                                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                        <i class="bi bi-three-dots"></i>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a class="dropdown-item" href="@Url.Action("AddEdit", "ProductVariant", new { id = item.VariantId })">
                                                                <i class="bi bi-pencil me-2"></i>Edit
                                                            </a>
                                                        </li>
                                                        <li><hr class="dropdown-divider"></li>
                                                        <li>
                                                            <a class="dropdown-item text-danger"
                                                               href="@Url.Action("Delete", "ProductVariant", new { id = item.VariantId })"
                                                               onclick="return confirm('Are you sure you want to delete this variant?');">
                                                                <i class="bi bi-trash me-2"></i>Delete
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-12">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <span class="text-muted small">Size</span>
                                                        <span class="size-badge">@(item.Size ?? "N/A")</span>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <span class="text-muted small">Price</span>
                                                        <span class="price-badge">@(item.Price?.ToString("C") ?? "N/A")</span>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-center p-2 bg-light rounded">
                                                        <div class="text-muted small">User ID</div>
                                                        <div class="fw-semibold text-primary-custom">@(item.UserId ?? 0)</div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="text-center p-2 bg-light rounded">
                                                        <div class="text-muted small">Created</div>
                                                        <div class="fw-semibold text-primary-custom">
                                                            @(item.CreatedAt?.ToString("MMM dd") ?? "N/A")
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card-footer bg-white border-top-0">
                                            <div class="action-buttons d-flex gap-2 flex-wrap">
                                                <a class="btn btn-outline-primary btn-sm flex-fill"
                                                   href="@Url.Action("AddEdit", "ProductVariant", new { id = item.VariantId })">
                                                    <i class="bi bi-pencil me-1"></i>Edit
                                                </a>
                                                <a class="btn btn-outline-danger btn-sm flex-fill"
                                                   href="@Url.Action("Delete", "ProductVariant", new { id = item.VariantId })"
                                                   onclick="return confirm('Are you sure you want to delete this variant?');">
                                                    <i class="bi bi-trash me-1"></i>Delete
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>

                    <!-- Table View -->
                    <div class="card mt-4" style="display: none;" id="tableView">
                        <div class="card-header card-header-custom">
                            <h5 class="mb-0"><i class="bi bi-table me-2"></i>Product Variants - Table View</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th><i class="bi bi-hash me-1"></i>Variant ID</th>
                                            <th><i class="bi bi-box me-1"></i>Product ID</th>
                                            <th><i class="bi bi-rulers me-1"></i>Size</th>
                                            <th><i class="bi bi-currency-dollar me-1"></i>Price</th>
                                            <th><i class="bi bi-person me-1"></i>User ID</th>
                                            <th><i class="bi bi-calendar me-1"></i>Created</th>
                                            <th class="text-center"><i class="bi bi-gear me-1"></i>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model != null)
                                        {
                                            @foreach (var item in Model)
                                            {
                                                <tr class="variant-item"
                                                    data-productid="@item.ProductId"
                                                    data-size="@item.Size?.ToLower()"
                                                    data-userid="@item.UserId">
                                                    <td><span class="badge bg-primary">@item.VariantId</span></td>
                                                    <td>@item.ProductId</td>
                                                    <td><span class="size-badge">@(item.Size ?? "N/A")</span></td>
                                                    <td><span class="price-badge">@(item.Price?.ToString("C") ?? "N/A")</span></td>
                                                    <td>@(item.UserId ?? 0)</td>
                                                    <td>@(item.CreatedAt?.ToString("MMM dd, yyyy") ?? "N/A")</td>
                                                    <td class="text-center">
                                                        <div class="btn-group">
                                                            <a class="btn btn-sm btn-outline-primary"
                                                               href="@Url.Action("AddEdit", "ProductVariant", new { id = item.VariantId })"
                                                               title="Edit">
                                                                <i class="bi bi-pencil"></i>
                                                            </a>
                                                            <a class="btn btn-sm btn-outline-danger"
                                                               href="@Url.Action("Delete", "ProductVariant", new { id = item.VariantId })"
                                                               title="Delete"
                                                               onclick="return confirm('Are you sure you want to delete this variant?');">
                                                                <i class="bi bi-trash"></i>
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle View Button -->
                    <div class="text-center mt-4">
                        <button id="toggleViewBtn" class="btn view-toggle-btn" onclick="toggleView()">
                            <i class="bi bi-arrow-repeat me-2"></i>Switch to Table View
                        </button>
                    </div>
                }
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let isCardView = true;

        function toggleView() {
            const cardView = document.getElementById('cardView');
            const tableView = document.getElementById('tableView');
            const toggleBtn = document.getElementById('toggleViewBtn');

            isCardView = !isCardView;
            cardView.style.display = isCardView ? 'flex' : 'none';
            tableView.style.display = isCardView ? 'none' : 'block';

            toggleBtn.innerHTML = isCardView
                ? '<i class="bi bi-arrow-repeat me-2"></i>Switch to Table View'
                : '<i class="bi bi-grid me-2"></i>Switch to Card View';
        }

        // Auto-submit form when product dropdown changes
        document.addEventListener('DOMContentLoaded', function() {
            const productSelect = document.getElementById('productId');
            if (productSelect) {
                productSelect.addEventListener('change', function() {
                    // Auto-submit form when product is selected
                    if (this.value) {
                        this.form.submit();
                    }
                });
            }
        });
    </script>
</body>
